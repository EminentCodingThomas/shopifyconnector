<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--Wizard for reset credentials-->
    <record id="view_reset_credentials_form" model="ir.ui.view">
        <field name="name">Reset Credentials</field>
        <field name="model">res.config.shopify.instance</field>
        <field name="arch" type="xml">
            <form class="oe_form_configuration">
                <h3>Reset credentials for Instance :
                    <field name="name" class="oe_inline" readonly="1"/>
                </h3>
                <group>
                    <group>
                        <field name='shopify_host' readonly="1"/>
                        <field name='shopify_api_key' required="1"/>
                    </group>
                    <group>
                        <field name='shopify_password' required="1" password="1" string="Access Token"/>
                        <field name='shopify_shared_secret' required="1"/>
                    </group>
                </group>
                <group>
                    <button name="reset_credentials" type="object" string="Test Connection"
                            icon="fa-television" context="{'test_connection':True}"/>
                </group>
                <footer>
                    <button string="Save" type="object"
                            name="reset_credentials" class="oe_highlight"/>
                    <button class="oe_highlight" special="cancel"
                            string="Cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <record id="view_res_config_shopify_instance"
            model="ir.ui.view">
        <field name="name">Configure Instance</field>
        <field name="model">res.config.shopify.instance</field>
        <field name="arch" type="xml">
            <form string="Configure Instance" class="o_shopify_ept">
                <group class="o_onboard_padding">
                    <group>
                        <field name="name" required="1"
                               readonly="context.get('is_already_instance_created', False)"/>
                        <field name='shopify_host'
                               placeholder="https://my-shopify-store.myshopify.com" required="1"
                               readonly="context.get('is_already_instance_created', False)"/>
                        <field name="shopify_company_id" required="1" string="Company"
                               options="{'no_create':True,'no_create':True,'no_create_edit':True}"
                               readonly="context.get('is_already_instance_created', False)"/>
                    </group>
                    <group>
                        <field name='shopify_api_key' required="1"
                               readonly="context.get('is_already_instance_created', False)"/>
                        <field name='shopify_password' required="1" password="1" string="Access Token"
                               readonly="context.get('is_already_instance_created', False)"/>
                        <field name='shopify_shared_secret' required="1"
                               readonly="context.get('is_already_instance_created', False)"/>
                    </group>
                </group>
                <group class="o_onboard_padding">
                    <style>
                        .embed-responsive-item {
                        width: 25rem !important;
                        min-height: 15rem !important;
                        }
                    </style>
                    <div name="row" style="display: flex;">
                        <div class='col-md-6' style="display: contents;">
                            <field name="shopify_api_video_url" invisible="1"/>
                            <div class="p-2">
                                <field name="shopify_api_video_embed_code" class="mt-2"/>
                            </div>
                        </div>
                        <div class='col-md-6' style="display: contents;">
                            <field name="shopify_instance_video_url" invisible="1"/>
                            <div class="p-2">
                                <field name="shopify_instance_video_embed_code" class="mt-2"/>
                            </div>
                        </div>
                    </div>
                </group>
                <group invisible="context.get('is_calling_from_onboarding_panel', False)" class="o_onboard_padding">
                    <p colspan="2" class="alert alert-warning" role="alert">
                        <div style="color:#ff0000; font-size:15px;">
                            <b>Important Note:</b>
                        </div>
                        <div class="d-inline-block w-100">
                            <div class="row">
                                <div class="col-11 p-0">
                                    <ul>
                                        <li>
                                            After creating the instance, please make sure you
                                            complete all
                                            the other
                                            necessary configurations such as Tax,
                                            Warehouse, Pricelist etc. from
                                            the Shopify setting screen.
                                        </li>
                                        <li>
                                            Shopify =&gt; Configurations =&gt; Settings
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </p>
                </group>
                <footer>
                    <button string="Create" type="object"
                            name="shopify_test_connection" class="oe_highlight"
                            invisible="context.get('is_already_instance_created', False)"/>
                    <button class="oe_highlight" special="cancel"
                            string="Cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!--Action for new instance creation-->
    <record id="res_config_action_shopify_instance"
            model="ir.actions.act_window">
        <field name="name">Instance</field>
        <field name="res_model">res.config.shopify.instance</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="view_id" ref="view_res_config_shopify_instance"/>
    </record>

    <!--Action for configuration of instance-->
    <record id="view_shopify_config_settings" model="ir.ui.view">
        <field name="name">Shopify Settings</field>
        <field name="model">res.config.settings</field>
        <field name="priority" eval="100"/>
        <field name="inherit_id"
               ref="base.res_config_settings_view_form"/>
        <field name="arch" type="xml">
           <xpath expr="//form" position="inside">
                <app data-string="Shopify" string="Shopify" name="shopify_ept" logo="/shopify_ept/static/description/icon.png">
                    <block title="Odoo Product Configuration" id="description_config">
                        <setting id="shopify_set_sales_description_in_product">
                            <field name="shopify_set_sales_description_in_product"/>
                            <span>If checked, it will be attached with Shopify Store's Product's description.</span>
                            <br/>
                            <span> - This configuration applies to all Shopify instances, not to a particular one.</span>
                            <br/>
                            <span> - The Description value received from Shopify is in HTML format, while it gets stored in Odoo product's field as Text format. Enable this only if it works for you.</span>
                            <br/>
                            <span> - The Odoo product's Sales Description will be used in the Sale order line. Generally, the description received from Shopify Store is lengthier, so enable this only if it works for you.</span>
                            <br/>
                            <span> - When a new product from Shopify is created in Odoo, it will set the Description into Odoo product's Sales Description field.</span>
                            <br/>
                            <span> - When an Odoo product is exported to Shopify, the Sales Description will be added.</span>
                        </setting>
                        <setting id="task_dependencies_setting">
                            <field name="show_net_profit_report" widget="upgrade_boolean" string="Shopify Net Profit Report"/>
                            <span> If you enable this configuration, it will add net profit report for all instances.</span>
                            <br/>
                            <span> - If you disable this configuration, it will remove net profit report automatically.</span>
                            <br/>
                            <span> - You can find Shopify net profit report from Shopify > Reporting > Net profit</span>
                            <br/>
                            <span> - The Shopify net profit report calculate based on instance level sets, analytics accounts</span>
                            <br/>
                            <div class="content-group" invisible="not show_net_profit_report">
                                <div class="mt16">
                                    <button name="download_shopify_net_profit_report_module" type="object" string="Download Shopify Net Profit Report Module" class="oe_link"
                                            invisible = "show_net_profit_report == False" help="Install this module if you are See Net profit report for all Instances."/>
                                </div>
                            </div>
                        </setting>
                    </block>
                    <block title="Instances" id="instances">
                        <setting id="shopify_instance_id">
                            <label for="shopify_instance_id" string="Select Instance"/>
                            <field name="shopify_instance_id" required="shopify_instance_id != False" options="{'no_create': True, 'no_create_edit' : True}"/>
                            <button name="%(res_config_action_shopify_instance)d" icon="fa-arrow-right" type="action" string="Create More Instance" class="oe_link"/>
                        </setting>
                    </block>
                    <block title="General Configuration" id="general_config_shopify" invisible ="shopify_instance_id == False">
                        <setting id="warehouse_config" invisible ="shopify_instance_id == False">
                            <field name="shopify_company_id" invisible="1"/>
                            <div class="row mt8">
                                <label for="shopify_warehouse_id" string="Warehouse"/>
                                <p>Selected Warehouse will be set in your Shopify orders.</p>
                                <field name="shopify_warehouse_id" class="o_light_label" widget="selection" required="shopify_instance_id != False"/>
                            </div>
                        </setting>
                        <setting id="language_config" invisible ="shopify_instance_id == False">
                            <div class="row mt8">
                                <label for="shopify_lang_id" string="Instance Language"/>
                                <p>Select language based on your Shopify instance</p>
                                <field name="shopify_lang_id" class="oe_inline" options="{'no_open':True,'no_create':True,'no_create_edit':True}" required = "shopify_instance_id != False"/>
                            </div>
                        </setting>
                    </block>
                    <block title="Webhook Configuration" id="shopify_webhook_header" invisible ="shopify_instance_id == False">
                        <div class="col-12 col-lg-12 o_setting_box">
                            <div class="alert alert-warning" role="alert">

                                <b>
                                    <h3 style="font-weight:bold;color:#7d5a29;padding: 0 !important;">
                                        <u>Note :</u>
                                    </h3>
                                    <ul>
                                        <li>Webhooks can be managed using below options.</li>
                                        <li>
                                                Enabling an option will either creates a new webhook for
                                                its all actions
                                                (such as 'create', 'update', 'delete' etc.) or activates
                                                it, if already
                                                exists.
                                        </li>
                                        <li>Disabling an option will deactivates the webhooks.</li>
                                        <li>
                                                Only instances having SSL connection (https://) are
                                                permitted.
                                        </li>
                                        <li>For detailed options,</li>
                                        <ol>
                                            <li>Go to Shopify >> Configuration >> Instances.</li>
                                            <li>Open an instance.</li>
                                            <li>Select Webhooks tab.</li>
                                        </ol>
                                    </ul>
                                </b>
                            </div>
                        </div>
                        <setting id="warehouse_config" invisible ="shopify_instance_id == False">
                            <field name="create_shopify_products_webhook" widget="boolean_toggle" style="margin-left: -0.5em" string="Manage Products via Webhooks"/>
                        </setting>
                        <setting id="warehouse_config" invisible ="shopify_instance_id == False">
                            <field name="create_shopify_customers_webhook" widget="boolean_toggle" style="margin-left: -0.5em" string="Manage Customers via Webhooks"/>
                        </setting>
                        <setting id="warehouse_config" invisible ="shopify_instance_id == False">
                            <field name="create_shopify_orders_webhook" widget="boolean_toggle" style="margin-left: -0.5em" string="Manage Orders via Webhooks"/>
                        </setting>
                    </block>
                    <block title="Product Configuration" invisible="shopify_instance_id == False">
                        <setting id="auto_import_product_config">
                            <field name="auto_import_product" widget="boolean_toggle" style="margin-left: -0.5em"/>
                            <span>- This option creates a new product in your catalogue if system
                                    couldn't find
                                    the product based on SKU / Internal Reference / Default Product
                                    Code.</span>
                            <br/>
                            <span> - If you are selling on multiple sales channels and having
                                    different SKU /
                                    Internal Reference / Default Product Code on each sales channel,
                                    it may lead to
                                    creation of duplicate products in your product catalogue in your
                                    database.</span>
                            <br/>
                            <span> - So we request you to enable this option, as per your product
                                    catalogue
                                    configuration.</span>
                        </setting>
                        <setting id="shopify_sync_product_with_images_config">
                            <field name="shopify_sync_product_with_images" widget="boolean_toggle" style="margin-left: -0.5em"/>
                            <span> If checked, it will automatically set product image while
                                    product import</span>
                        </setting>
                        <setting id="shopify_sync_product_with_config">
                            <div class="row mt8">
                                <label for="shopify_sync_product_with"/>
                                <p>While sync products from Shopify to Odoo at the moment it will
                                    sync Odoo and
                                    Shopify products base on the selection.</p>
                                <field name="shopify_sync_product_with" class="o_light_label" widget="selection" required="shopify_instance_id != False "/>
                            </div>
                        </setting>
                        <setting id="shopify_pricelist_id_config">
                            <div class="row mt8">
                                <label for="shopify_pricelist_id" string="Pricelist"/>
                                <div class="text-muted">
                                    1.During product sync operation, prices will be
                                    Imported/Exported using this
                                    Pricelist.
                                    <br/>
                                    2.During order sync operation, this pricelist will be set in the
                                    order if the
                                    order currency from store and the currency from the pricelist
                                    set here, matches.
                                </div>
                                <field name="shopify_pricelist_id" class="o_light_label" required="shopify_instance_id != False"/>
                            </div>
                        </setting>
                    </block>
                    <block title="Order Configuration" invisible="shopify_instance_id == False">
                        <setting id="shopify_order_status_ids_config">
                            <div class="row mt8">
                                <label for="shopify_order_status_ids" string="Import Order Status"/>
                                <div class="text-muted">
                                    Select order status which you want to import orders from Shopify store to odoo.
                                </div>
                                <field name="shopify_order_status_ids"
                                               widget="many2many_tags"
                                               required="shopify_instance_id != False"
                                               options="{'no_create':True,'no_create_edit': True}"
                                               class="oe_inline"/>
                            </div>
                        </setting>
                        <setting id="auto_fulfill_gift_card_order_config">
                            <field name="auto_fulfill_gift_card_order" widget="boolean_toggle"
                                       style="margin-left: -0.5em"/>
                            <div class="text-muted">
                                    Set this configuration as per Shopify store configuration.
                                    <br/>
                                    Here is Shopify store configuration(Settings > Checkout > Order processing).
                                    <br/>
                                    If unchecked, It will fulfill qty from Odoo to Shopify in update order status
                                    process.
                            </div>           
                        </setting>
                        <setting id="shopify_section_id_config">
                            <div class="row mt8">
                                <label for="shopify_section_id" string="Sales Team"/>
                                <div class="text-muted">
                                    Set the sales team for shopify orders.
                                </div>
                                <field name="shopify_section_id" class="o_light_label"/>
                            </div>
                        </setting>
                        <setting id="shopify_default_pos_customer_id_config">
                            <div class="row mt8">
                                <label for="shopify_default_pos_customer_id"/>
                                <div class="text-muted">
                                    This Customer will be set in POS order not having any customer.  
                                </div>
                                <field name="shopify_default_pos_customer_id" class="o_light_label"
                                               options="{'no_create':True,'no_create_edit': True}"/>
                            </div>
                        </setting>
                        <setting id="shopify_analytic_account_id_config" groups="analytic.group_analytic_accounting">
                            <div class="row mt8">
                                <label for="shopify_analytic_account_id" string="Analytic Account"/>
                                <div class="text-muted">
                                    Set the Analytic account for shopify orders.
                                    <li>
                                        Note : The configuration of the analytic account for this instance will be
                                        applied to all sales orders created by the connector. With this configuration,
                                        the Analytic Default Rule configured in Odoo will not apply to Shopify orders
                                        invoices. If you wish to use Odoo Analytic Default Rule, you will not have to
                                        configure any analytic account here.
                                    </li>
                                </div>
                                <field name="shopify_analytic_account_id" class="o_light_label"
                                               options="{'no_create':True,'no_create_edit': True}"/>
                            </div>
                        </setting>
                        <setting id="shopify_is_use_default_sequence_config">
                    
                            <field name="shopify_is_use_default_sequence" widget="boolean_toggle"
                                       style="margin-left: -0.5em" string= "Use Odoo Default Sequence?"/>
                            <span> If checked,Then use default sequence of odoo for sale order
                                    create.</span>
                        
                        </setting>
                        <setting id="shopify_order_prefix_config" invisible="shopify_is_use_default_sequence == True">
                            <div class="row mt8">
                                <label for="shopify_order_prefix"/>
                                <div class="text-muted">
                                    Enter Order Prefix 
                                </div>
                                <field name="shopify_order_prefix" class="o_light_label"/>
                            </div>
                        </setting>
                        <setting id="shopify_import_order_after_date_config">
                            <div class="row mt8">
                                <label for="shopify_import_order_after_date" string="Import Order After Date"/>
                                <div class="text-muted">
                                    System will import only those orders which are created
                                    after this configured date.
                                </div>
                                <field name="shopify_import_order_after_date"
                                               required="shopify_instance_id != False"/>
                            </div>
                        </setting>
                        <setting id="order_visible_currency_config">
                    
                            <field name="order_visible_currency" widget="boolean_toggle"
                                       style="margin-left: -0.5em"/>
                            <span> If checked, It will import orders based on the customer's visible currency through
                                    which the customer has paid the payment for orders.</span>
                        
                        </setting>
                        <setting id="is_delivery_fee_config">
                    
                            <field name="is_delivery_fee" widget="boolean_toggle"
                                       style="margin-left: -0.5em" string="Are you selling for Colorado State(US)?"/>
                            <div class="text-muted">
                                    If checked, the connector will add a delivery fee line to the order.
                                    <ul>
                                        <li>The connector support the Colorado special tax rule during import orders.
                                        </li>
                                    </ul>
                                    For more details,
                                    <a href="https://help.shopify.com/en/manual/taxes/us/us-tax-reference#colorado"
                                       target="_blank">
                                        click here
                                    </a>
                                </div>
                                <br/>
                                <div class="row mt8" invisible="is_delivery_fee == False">
                                    <label for="delivery_fee_name"/>
                                    <div class="text-muted">
                                        The name you enter here must match the label on the Shopify order that shows the
                                        Colorado delivery fees applied.
                                    </div>
                                    <field name="delivery_fee_name"
                                                   required="is_delivery_fee == True"
                                                   class="o_light_label"/>
                            </div>

                        
                        </setting>
                        <setting id="is_delivery_multi_warehouse_config">
                    
                            <field name="is_delivery_multi_warehouse" widget="boolean_toggle"
                                       style="margin-left: -0.5em" string="Is Delivery from Multiple warehouse?"/>
                            <span> If checked, It will update order status based on multiple warehouse in Shopify
                                    store.</span>
                        
                        </setting>
                        <setting id="import_customer_as_company_config">
                    
                            <field name="import_customer_as_company" widget="boolean_toggle"
                                       style="margin-left: -0.5em" string= "Import Customer as Company?"/>
                            <span> If checked, it will create an individual Company type partner from the Company
                                    name and customer will be created as a child partner of Company.</span>
                        
                        </setting>
                    </block>
                    <block title="Tax Configuration" id="tax_configuration">
                        <setting id="shopify_apply_tax_in_order_config">
                            <label for="shopify_apply_tax_in_order"
                                       string="Apply Tax"/>
                                <div class="text-muted">
                                    1) Odoo Default Tax Behaviour - The Taxes will be set based on
                                    Odoo's default
                                    functional behaviour i.e. based on Odoo's Tax and Fiscal
                                    Position
                                    configurations.
                                    <br/>
                                    2) Create New Tax If Not Found - System will search the tax data
                                    received from
                                    Shopify in Odoo, will create a new one if it fails in finding
                                    it.
                                </div>
                                <field name="shopify_apply_tax_in_order"
                                               class="o_light_label"
                                               required="shopify_instance_id != False"/>
                        </setting>
                        <setting id="shopify_credit_tax_account_id_config" invisible="shopify_apply_tax_in_order == 'odoo_tax'">
                            <label for="shopify_credit_tax_account_id"
                                       string="Credit Note Tax Account"/>
                                <div class="text-muted">
                                    Set the credit tax account base on this account we will set this
                                    account in the
                                    newly created tax when import orders from Shopify to Odoo.
                                </div>
                                <field name="shopify_credit_tax_account_id"
                                               required = "(shopify_apply_tax_in_order =='create_shopify_tax') and (shopify_instance_id != False)"
                                               class="o_light_label"/>
                        </setting>
                        <setting id="shopify_credit_tax_account_id_config" invisible="shopify_apply_tax_in_order == 'odoo_tax'">
                            <label for="shopify_invoice_tax_account_id"
                                       string="Invoice Tax Account"/>
                                <div class="text-muted">
                                    Set the invoice tax account base on this account we will set
                                    this account in the newly created tax when import orders
                                    from Shopify to Odoo.
                                </div>
                                <field name="shopify_invoice_tax_account_id"
                                               required="(shopify_apply_tax_in_order == 'create_shopify_tax') and (shopify_instance_id != False)"
                                               class="o_light_label"/>
                        </setting>
                    </block>
                    <block title="Notify By Email" invisible ="shopify_instance_id == False">
                        <setting id="shopify_notify_customer_config">
                            <field name="shopify_notify_customer" widget="boolean_toggle"
                                       style="margin-left: -0.5em"/>
                            <span> If checked, Then customers will update while
                                    change the
                                    order status.</span>
                        </setting>
                        
                    </block>
                    <block title="Stock Information" invisible ="shopify_instance_id == False">
                        <setting id="shopify_stock_field_config">
                            <label for="shopify_stock_field"/>
                                <div class="text-muted">
                                    Select inventory field for shopify products.
                                    <br/>
                                    Forecast Quantity = Quantity On Hand - Outgoing + Incoming
                                    <br/>
                                    Free To Use Quantity = Quantity On Hand - Reserved quantity
                                </div>
                                <field name="shopify_stock_field" class="o_light_label"
                                               widget="selection"
                                               domain="[('model_id.model','=','product.product'),('name','in',['free_qty','virtual_available','qty_available'])]"
                                               required="shopify_instance_id != False"/>
                        </setting>
                        
                    </block>
                    <block title="Schedule Activity Information" invisible ="shopify_instance_id == False">
                        <setting id="is_shopify_create_schedule_config">
                            <field name="is_shopify_create_schedule" widget="boolean_toggle"
                                       style="margin-left: -0.5em"/>
                            <span> If checked, Then Schedule Activity create.</span>
                        </setting>
                        <setting id="shopify_activity_type_id_config" invisible="is_shopify_create_schedule == False">
                            <label for="shopify_activity_type_id" string="Activity Type"/>
                                <div class="text-muted">
                                    Select Schedule Activity Type
                                </div>    
                                <field name="shopify_activity_type_id"
                                               class="oe_inline"
                                               required="is_shopify_create_schedule == True"/>
                        </setting>
                        <setting id="shopify_user_ids_config" invisible="is_shopify_create_schedule == False">
                            <label for="shopify_user_ids"/>
                                <div class="text-muted">
                                    Select Responsible User
                                </div>
                                <field name="shopify_user_ids" widget="many2many_tags"
                                               class="oe_inline"
                                               required="is_shopify_create_schedule == True"/>
                        </setting>
                        <setting id="shopify_date_deadline_config" invisible="is_shopify_create_schedule == False">
                            <label for="shopify_date_deadline" string="Deadline Lead Days"/>
                                <div class="text-muted">
                                    Enter Lead Days For Deadline Date Of Schedule
                                    Activity
                                </div>
                                <field name="shopify_date_deadline"
                                               class="o_light_label"
                                               required ="is_shopify_create_schedule == True"/>
                        </setting>
                        
                    </block>
                    <block title="Payout Report Information" invisible ="shopify_instance_id == False">
                        <setting id="shopify_settlement_report_journal_id_config">
                            <label for="shopify_settlement_report_journal_id"/>
                                <div class="text-muted">
                                    Creates Bank Statement using this journal while process Payout Report (This will
                                    apply for shopify payment method only).
                                </div>
                                <field name="shopify_settlement_report_journal_id" class="o_light_label"
                                               domain="[('type','in',['cash','bank']),('company_id','=',shopify_company_id)]"
                                               options="{'no_create':True,'no_open':True}"/>
                        </setting>  
                    </block>
                    <block title="Digest" invisible ="shopify_instance_id == False">
                        <setting id="is_shopify_digest_config">
                            <field name="is_shopify_digest" widget="boolean_toggle" string="Send Periodic Digest?"
                                       style="margin-left: -0.5em"/>
                            <span> If checked, Then it will send periodic digest per KPI.</span>
                        </setting>
                    </block>
                </app>
            </xpath>
        </field>
    </record>

    <!--This action used open setting from instance kanban view.-->
    <record id="action_shopify_instance_config"
            model="ir.actions.act_window">
        <field name="name">Settings</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.config.settings</field>
        <field name="view_mode">form</field>
        <field name="context">{'default_shopify_instance_id': active_id}</field>
        <field name="target">inline</field>
    </record>

    <record id="action_shopify_config"
            model="ir.actions.act_window">
        <field name="name">Shopify</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.config.settings</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_shopify_config_settings"/>
        <field name="target">inline</field>
        <field name="context">{'module' : 'shopify_ept'}</field>
    </record>

    <menuitem id="menu_shopify_config" name="Settings"
              parent="shopify_ept.menu_configuration_ept" sequence="1"
              action="action_shopify_config"
              groups="shopify_ept.group_shopify_manager_ept"/>
</odoo>
